"美国柴油进口（千桶/天）",
"美国燃料油进口（千桶/天）",
"美国原油出口（千桶/天）",
"美国汽油出口（千桶/天）",
"美国航煤出口（千桶/天）",
"美国柴油出口（千桶/天）",
"美国燃料油出口（千桶/天）",
"美国汽油需求（千桶/天）",
"美国航煤需求（千桶/天）",
"美国柴油需求（千桶/天）",
"美国燃料油需求（千桶/天）"
)
][, sub_title := fcase(
str_detect(name, "汽油"), "汽油",
str_detect(name, "柴油"), "柴油",
str_detect(name, "航煤"), "航煤",
str_detect(name, "燃料油"), "燃料油",
default = "原油"
)
][, .SD, .SDcols = c(10, 9, 3, 4)
][order(sub_title, name), .SD
][, setnames(.SD, 2:4, c(str_c("EIA周度数据", d), "本期", "上期"))
][, ':='(`本期` = str_replace_all(`本期`, ",", "") %>% as.numeric() %>% round(digits = 2),
`上期` = str_replace_all(`上期`, ",", "") %>%  as.numeric() %>% round(digits = 2))
][, `变化` := (`本期` - `上期`) %>% round(digits = 2)]
# 调整表格颜色
pal <- function(x) {
f_neg <- scales::col_numeric(
palette = c("#69cfd5"),
domain = c(-10e6, 0)
)
f_pos <- scales::col_numeric(
palette = c("#feb8cd"),
domain = c(0, 10e6)
)
f_zero <- scales::col_numeric(
palette = c("#ffffff"),
domain = c(0)
)
fcase(x < 0, f_neg(x),
x > 0, f_pos(x),
x == 0, f_zero(x))
}
eia_updated_weekly %>%
group_by(sub_title) %>%
gt() %>%
tab_options(
column_labels.font.size = 18,
column_labels.font.weight = "bold",
) %>%
data_color(columns = `变化`,
colors = pal
) %>% gtsave("tab_1.png", expand = 30)
# 1.周度变化表
eia_updated <- fread("https://ir.eia.gov/wpsr/table9.csv")
d <- colnames(eia_updated)[3]
eia_updated_weekly <- eia_updated[!str_detect(STUB_2, "PADD")
][str_detect(STUB_2, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(STUB_1, "Crude")) |
(str_detect(STUB_1, "Refiner Inputs")) |
(str_detect(STUB_1, "Refiner and Blender") & !str_detect(STUB_2, "Adjustment|Commercial")) |
(str_detect(STUB_1, "Stocks") & !str_detect(STUB_2, "Crude")) |
(str_detect(STUB_1, "Imports") & str_detect(STUB_2, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(STUB_1, "Exports")) |
(str_detect(STUB_1, "Supplied"))
][!str_detect(STUB_1, "Net Imports") & !str_detect(STUB_2, "Crude Oil Inputs")
][, name := c(
"美国原油产量（千桶/天）",
"美国炼厂运营炼能（千桶/天）",
"美国炼厂产能利用率（%）",
"美国汽油产量（千桶/天）",
"美国航煤产量（千桶/天）",
"美国柴油产量（千桶/天）",
"美国燃料油产量（千桶/天）",
"美国商业原油库存（百万桶）",
"美国库欣原油库存（百万桶）",
"美国战略原油储备（百万桶）",
"美国汽油库存（百万桶）",
"美国航煤库存（百万桶）",
"美国柴油库存（百万桶）",
"美国燃料油库存（百万桶）",
"美国原油成品油总库存去除战略储备（百万桶）",
"美国原油成品油总库存包含战略储备（百万桶）",
"美国原油进口（千桶/天）",
"美国汽油进口（千桶/天）",
"美国航煤进口（千桶/天）",
"美国柴油进口（千桶/天）",
"美国燃料油进口（千桶/天）",
"美国原油出口（千桶/天）",
"美国汽油出口（千桶/天）",
"美国航煤出口（千桶/天）",
"美国柴油出口（千桶/天）",
"美国燃料油出口（千桶/天）",
"美国汽油需求（千桶/天）",
"美国航煤需求（千桶/天）",
"美国柴油需求（千桶/天）",
"美国燃料油需求（千桶/天）"
)
][, sub_title := fcase(
str_detect(name, "汽油"), "汽油",
str_detect(name, "柴油"), "柴油",
str_detect(name, "航煤"), "航煤",
str_detect(name, "燃料油"), "燃料油",
default = "原油"
)
][, .SD, .SDcols = c(10, 9, 3, 4)
][order(sub_title, name), .SD
][, setnames(.SD, 2:4, c(str_c("EIA周度数据", " ", d), "本期", "上期"))
][, ':='(`本期` = str_replace_all(`本期`, ",", "") %>% as.numeric() %>% round(digits = 2),
`上期` = str_replace_all(`上期`, ",", "") %>%  as.numeric() %>% round(digits = 2))
][, `变化` := (`本期` - `上期`) %>% round(digits = 2)]
# 调整表格颜色
pal <- function(x) {
f_neg <- scales::col_numeric(
palette = c("#69cfd5"),
domain = c(-10e6, 0)
)
f_pos <- scales::col_numeric(
palette = c("#feb8cd"),
domain = c(0, 10e6)
)
f_zero <- scales::col_numeric(
palette = c("#ffffff"),
domain = c(0)
)
fcase(x < 0, f_neg(x),
x > 0, f_pos(x),
x == 0, f_zero(x))
}
eia_updated_weekly %>%
group_by(sub_title) %>%
gt() %>%
tab_options(
column_labels.font.size = 18,
column_labels.font.weight = "bold",
) %>%
data_color(columns = `变化`,
colors = pal
) %>% gtsave("tab_1.png", expand = 30)
d <- colnames(eia_updated)[3] %>% as.Date("%Y/%m/%d")
d <- colnames(eia_updated)[3] %>% as.Date("%y/%m/%d")
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(name, "Crude")) |
(str_detect(name, "Refiner Inputs")) |
(str_detect(name, "Refiner and Blender") & !str_detect(name, "Adjustment|Commercial")) |
(str_detect(name, "Stocks") & !str_detect(name, "Crude")) |
(str_detect(name, "Imports") & str_detect(name, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(name, "Exports")) |
(str_detect(name, "Supplied"))
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(name, "Crude")) |
(str_detect(name, "Refiner Inputs")) |
(str_detect(name, "Refiner and Blender") & !str_detect(name, "Adjustment|Commercial")) |
(str_detect(name, "Stocks") & !str_detect(name, "Crude")) |
(str_detect(name, "Imports") & str_detect(name, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(name, "Exports")) |
(str_detect(name, "Supplied"))
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(name, "Crude")) |
(str_detect(name, "Refiner Inputs")) |
(str_detect(name, "Refiner and Blender") & !str_detect(name, "Adjustment|Commercial")) |
(str_detect(name, "Stocks") & !str_detect(name, "Crude")) |
(str_detect(name, "Imports") & str_detect(name, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(name, "Exports")) |
(str_detect(name, "Supplied"))
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Export of Crude Oil and Petroleum")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(name, "Crude")) |
(str_detect(name, "Refiner Inputs")) |
(str_detect(name, "Refiner and Blender") & !str_detect(name, "Adjustment|Commercial")) |
(str_detect(name, "Stocks") & !str_detect(name, "Crude")) |
(str_detect(name, "Imports") & str_detect(name, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(name, "Exports")) |
(str_detect(name, "Supplied"))
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][
(str_detect(name, "Crude")) |
(str_detect(name, "Refiner Inputs")) |
(str_detect(name, "Refiner and Blender") & !str_detect(name, "Adjustment|Commercial")) |
(str_detect(name, "Stocks") & !str_detect(name, "Crude")) |
(str_detect(name, "Imports") & str_detect(name, "Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Crude")) |
(str_detect(name, "Exports")) |
(str_detect(name, "Supplied"))
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic Production|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity"), .SD
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports") & !str_detect(name, "Crude Oil Inputs")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender | Refiner  ")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender | Refiner  ")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Domestic|Percent Utilization|Finished Motor Gasoline|Distillate Fuel Oil|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender | Refiner  ")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "
Percent Utilization|
Finished Motor Gasoline|
Distillate Fuel Oil|
Kerosene-Type Jet Fuel|
Residual Fuel Oil|
Commercial|
Cushing|
SPR|
Total Stocks|
Crude Oil|
Operable Capacity|
Total Crude Oil and Petroleum Products
"), .SD
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender|Refiner")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Refiner Net Input")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender|Refiner")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Refiner and Blender|Refiner")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly <- petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][!str_detect(name, "PADD")
][str_detect(name, "Percent Utilization|Finished Motor Gasoline|Distillate|Kerosene-Type Jet Fuel|Residual Fuel Oil|Commercial|Cushing|SPR|Total Stocks|Crude Oil|Operable Capacity|Total Crude Oil and Petroleum Products"), .SD
][!str_detect(name, "Net Imports")
][!str_detect(name, "Sulfur|Military|48|Alaska|Adjusted|Adjustment")
][!str_detect(name, "Exports of Crude Oil and Petroleum|Commercial Kerosene-Type")
][!str_detect(name, "Imports by SPR|Imports for SPR|Imports Excluding SPR")
][!str_detect(name, "Days")]
petroleum_updated_weekly[, unique(name)]
# 2. 25张季节性图
ld(petroleum_updated_weekly, force = T)
petroleum_updated_weekly[str_detect(name, "Commercial"), unique(name)]
petroleum_updated_weekly[str_detect(name, "Crude Oil"), unique(name)]
petroleum_updated_weekly[grandp_name == "Summary"& f == "W"
][str_detect(name, "Crude Oil")|str_detect(name, "Commercial"), unique(name)]
petroleum_updated_weekly[grandp_name == "Summary"& f == "W"&!str_detect(name, "PADD")
][str_detect(name, "Crude Oil")|str_detect(name, "Commercial"), unique(name)]
petroleum_updated_weekly[grandp_name == "Summary"& f == "W"&!str_detect(name, "PADD")
][(str_detect(name, "Crude Oil")|str_detect(name, "Commercial"))&str_detect(name, "Stock"), unique(name)]
petroleum_updated_weekly[name == "U.S. Ending Stocks excluding SPR of Crude Oil, Weekly", .SD[1]]
petroleum_updated_weekly[, max(date)]
library(styleer)
library(eia)
# 1. 获取流量或者存量（eia_series函数的argument选项n = NULL或1）
petroleum_categories <- eia_cats(714755)$childcategories %>% as.data.table()
petroleum_categories <- petroleum_categories[, eia_cats(category_id)$childcategories %>% list() %>% rbindlist(), by = .(parent_name = name)
][str_detect(name, "Week")]
# 1.1 一层嵌套
petroleum_categories_1 <- petroleum_categories[, eia_cats(category_id)$childseries %>% list() %>% rbindlist(), by = .(grandp_name = parent_name, parent_name = name)
][, eia_series(series_id, n = 1)[["data"]] %>% rbindlist(), by = .(grandp_name, parent_name, name, f, units, updated)
]
petroleum_categories_1[, area := fcase(
str_detect(name, "U.S."), "U.S.",
str_detect(name, "PADD 1"), "PADD 1",
str_detect(name, "PADD 2"), "PADD 2",
str_detect(name, "PADD 3"), "PADD 3",
str_detect(name, "PADD 4"), "PADD 4",
str_detect(name, "PADD 5"), "PADD 5"
)
][, type := fifelse(area == "U.S.", str_extract(name, "\\.(.+)\\,"), str_extract(name, "\\)(.+)\\,"))
][, type := str_replace(type, "\\.S\\.|\\)", "")
][, type := str_replace(type, ",", "") %>% str_trim()]
# 1.2 两层嵌套
# summary与其他分开
petroleum_categories_2 <- petroleum_categories[, eia_cats(category_id)$childcategories %>% list() %>% rbindlist(), by = .(grandp_name = parent_name, parent_name = name)
][name == "by Data Series", eia_cats(category_id)$childcategories %>% list() %>% rbindlist(), by = .(grandp_name, parent_name)
][, eia_cats(category_id)$childseries %>% list() %>% rbindlist(), by = .(grandp_name, parent_name, type = name)
][f== "4"|f=="W", eia_series(series_id, n = 1)[["data"]] %>% rbindlist(fill = T), by = .(grandp_name, parent_name, name, f, units, updated)]
petroleum_categories_2[, area := fcase(
str_detect(name, "U.S."), "U.S.",
str_detect(name, "PADD 1"), "PADD 1",
str_detect(name, "PADD 2"), "PADD 2",
str_detect(name, "PADD 3"), "PADD 3",
str_detect(name, "PADD 4"), "PADD 4",
str_detect(name, "PADD 5"), "PADD 5"
)
][, type := fifelse(area == "U.S.", str_extract(name, "\\.(.+)\\,"), str_extract(name, "\\)(.+)\\,"))
][, type := str_replace(type, "\\.S\\.|\\)", "")
][, type := str_replace(type, ",", "") %>% str_trim()
]
# 2. 与存量数据整合在一起
# 有一些type和area存在NA的情况，没有进行处理
ld(petroleum_updated_weekly)
petroleum_updated_flow_weekly <- list(petroleum_categories_1, petroleum_categories_2) %>% rbindlist()
petroleum_updated_weekly <- list(petroleum_updated_weekly, petroleum_updated_flow_weekly) %>% rbindlist()
sv(petroleum_updated_weekly, svname = petroleum_updated_weekly)
eia_cats()
petroleum_categories <- eia_cats(714755)$childcategories %>% as.data.table()
petroleum_categories <- petroleum_categories[, eia_cats(category_id)$childcategories %>% list() %>% rbindlist(), by = .(parent_name = name)
][str_detect(name, "Week")]
# 1. 获取流量或者存量（eia_series函数的argument选项n = NULL或1）
petroleum_categories <- eia_cats(714755)$childcategories %>% as.data.table()
petroleum_categories <- petroleum_categories[, eia_cats(category_id)$childcategories %>% list() %>% rbindlist(), by = .(parent_name = name)
][str_detect(name, "Week")]
